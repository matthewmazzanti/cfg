#!/usr/bin/env bash

function update_flake() {
    pushd $1
    nix flake update
    if ! git diff --exit-code flake.lock >/dev/null; then
        git add flake.lock
    fi
    popd
}

pushd $ROOT

update_flake "$ROOT/pkgs/nvim"
update_flake "$ROOT/pkgs/zsh"
update_flake "$ROOT/pkgs/short-pwd"

if ! git diff --exit-code --staged >/dev/null; then
    git commit -m "Update pkgs/*/flake.lock"
fi

nix flake update --commit-lock-file
popd
